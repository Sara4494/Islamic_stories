<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØªØ¬Ø±Ø¨Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body{font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:#f7f7f8; margin:0; padding:0; display:flex; min-height:100vh; align-items:center; justify-content:center}
    .card{background:#fff; padding:24px; border-radius:16px; box-shadow:0 10px 25px rgba(0,0,0,.06); width:min(520px, 92vw)}
    h1{font-size:20px; margin:0 0 12px}
    p{margin:0 0 16px; color:#444}
    button{appearance:none; border:0; border-radius:10px; padding:12px 16px; font-size:16px; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,.08)}
    .primary{background:#1a73e8; color:#fff}
    code{background:#f1f3f4; padding:2px 6px; border-radius:6px}
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
    .muted{font-size:12px; color:#666}
  </style>
</head>
<body>
  <div class="card">
    <h1>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Google (ØªØ¬Ø±Ø¨Ø©)</h1>
    <p>Ù‡Ø°Ø§ Ø§Ù„Ù…Ø«Ø§Ù„ ÙŠØ³ØªØ®Ø¯Ù… <strong>Google Identity Services</strong> Ù„Ø¥Ø¬Ø±Ø§Ø¡ ØªØ¯ÙÙ‚ <strong>Authorization Code</strong> Ù…Ø¹ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯.</p>

    <div class="row">
      <button id="google-btn" class="primary">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Google</button>
      <a id="fallback-link" href="#" rel="opener" style="text-decoration:none">Ø±Ø§Ø¨Ø· Ø¨Ø¯ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±</a>
    </div>

    <p class="muted" style="margin-top:16px">
      Ø³ÙŠØªØ­ÙˆÙ„ Ø§Ù„Ù…ØªØµÙØ­ Ø¥Ù„Ù‰:
      <code>http://localhost:8000/api/auth/google/callback/?code=...&state=...</code>
      Ø«Ù… ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ Ø¨Ù…Ø¨Ø§Ø¯Ù„Ø© <code>code</code> Ø¨ØªÙˆÙƒÙ†Ø§Øª.
    </p>

    <hr style="margin:20px 0; border:none; border-top:1px solid #eee" />

    <p class="muted">ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¶Ø§ÙØ© Ø£ØµÙ„ JavaScript Ø§Ù„Ù…Ø³Ù…ÙˆØ­: 
      <code>http://localhost:5500</code> Ø£Ùˆ Ù†ÙØ³ Ø£ØµÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„ØªÙŠ ØªÙØªØ­ Ù…Ù†Ù‡Ø§ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù.
    </p>
  </div>

  <script>
    // âš™ï¸ Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ù‚ÙŠÙ… Ø­Ø³Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ
    const CLIENT_ID = "710392951784-usr2rfb7jau79p1oqpb9tof7nrbfm18m.apps.googleusercontent.com";
    const REDIRECT_URI = "http://localhost:8000/api/auth/google/callback/"; // Ù…Ù† Google Console
    const SCOPE = "openid email profile";

    // ØªÙˆÙ„ÙŠØ¯ state Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† CSRF (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„ÙƒÙ† Ù…Ø³ØªØ­Ø³Ù†)
    function randomState(len = 24) {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      let out = '';
      for (let i = 0; i < len; i++) out += chars.charAt(Math.floor(Math.random()*chars.length));
      return out;
    }
    const STATE = randomState();

    // âœ… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§: Google Identity Services â€” Code Flow Ù…Ø¹ redirect
    window.onload = function () {
      if (!window.google || !google.accounts || !google.accounts.oauth2) return;

      const codeClient = google.accounts.oauth2.initCodeClient({
        client_id: CLIENT_ID,
        scope: SCOPE,
        redirect_uri: REDIRECT_URI,
        state: STATE,
        ux_mode: 'redirect',
      });

      document.getElementById('google-btn').addEventListener('click', function(){
        codeClient.requestCode();
      });

      // ğŸ”— Ø±Ø§Ø¨Ø· Ø¨Ø¯ÙŠÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù‚Ø·Ø© Ù†Ù‡Ø§ÙŠØ© OAuth Ù…Ø¨Ø§Ø´Ø±Ø© (Ø¨Ø¯ÙˆÙ† Ù…ÙƒØªØ¨Ø©)
      const params = new URLSearchParams({
        client_id: CLIENT_ID,
        redirect_uri: REDIRECT_URI,
        response_type: 'code',
        scope: SCOPE,
        access_type: 'offline', // Ù„Ø¥Ø±Ø¬Ø§Ø¹ refresh_token ÙÙŠ Ø£ÙˆÙ„ Ù…Ø±Ø© Ù…Ø¹ prompt=consent
        prompt: 'consent',
        state: STATE
      });
      document.getElementById('fallback-link').href = `https://accounts.google.com/o/oauth2/v2/auth?${params.toString()}`;
    };
  </script>
</body>
</html>
